name: CD pipeline

on:
  push:
    branches:
      - main

jobs:
  Deploy:
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Debug: confirm Docker is available
      - name: Docker version
        run: docker --version

      # Debug: list current images and containers
      - name: List images before pull
        run: docker images

      - name: List containers before deploy
        run: docker ps -a

      # Pull the image from DockerHub using your secret username
      - name: Pull Docker image
        run: docker pull ${{ secrets.DOCKERHUB_USERNAME }}/calculator-app:v1

      # Remove old container if it exists
      - name: Delete old container
        run: docker rm -f calculator-app || true

      # Run the container
      - name: Run Docker container
        run: docker run -d -p 5000:5000 --name calculator-app ${{ secrets.DOCKERHUB_USERNAME }}/calculator-app:v1

      # Debug: confirm container is running
      - name: List containers after deploy
        run: docker ps -a



